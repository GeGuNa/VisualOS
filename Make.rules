.PRECIOUS: $(OBJ_DIR)/%.o

$(OBJ_DIR)/%.o:		$(THIS)/%.c
					$(CC) $(CFLAGS) -c $< -o $@

$(OBJ_DIR)/%.o:		$(THIS)/%.cpp
					$(CXX) $(CXXFLAGS) -c $< -o $@

$(OBJ_DIR)/%.o:		$(THIS)/%.asm
					$(AS) $(ASFLAGS) $< -o $@

#######################################

LINKED_OBJS	:= $(OBJ_DIR)/%.elf $(LIB_DIR)/%.so
$(LINKED_OBJS):		$(OBJ_DIR)/%.o
					$(LD) $(LDFLAGS) $^ $(LDADDITIONS) -o $@ $(LOADLIBES)

$(LIB_DIR)/%.a:		$(OBJ_DIR)/%.o
					$(AR) $(ARFLAGS) $@ $^

$(BUILD_DIR)/%.efi:	$(LIB_DIR)/%.so
					$(OBJCOPY) -j .text -j .sdata -j .data -j .dynamic -j .dynsym -j .rel -j .rela -j .reloc $(OBJCOPYFLAGS) $< $@

# Convert to assembly
$(ASMDUMP_DIR)/%.s:	$(THIS)/%.c
					$(CC) $(CFLAGS) -S -masm=intel -fverbose-asm $< -o $@

$(ASMDUMP_DIR)/%.s:	$(THIS)/%.cpp
					$(CXX) $(CXXFLAGS) -S -masm=intel -fverbose-asm $< -o $@
